# Install Oh My Zsh if needed
[[ -d ${HOME}/.oh-my-zsh ]] || sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

# Create Oh-My-Zsh custom subdirs if missing
CUSTOM="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}"
[[ -d ${CUSTOM} ]]         || mkdir -p ${CUSTOM}
[[ -d ${CUSTOM}/themes ]]  || mkdir -p ${CUSTOM}/themes
[[ -d ${CUSTOM}/plugins ]] || mkdir -p ${CUSTOM}/plugins

# Install zsh-autosuggestions Oh-My-Zsh plugin if missing
DESTDIR="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-autosuggestions"
[[ -d ${DESTDIR} ]] || git clone --depth=1 https://github.com/zsh-users/zsh-autosuggestions.git ${DESTDIR}

# Install zsh-syntax-highlighting Oh-My-Zsh plugin if missing
DESTDIR="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting"
[[ -d ${DESTDIR} ]] || git clone --depth=1 https://github.com/zsh-users/zsh-syntax-highlighting.git ${DESTDIR}

# Create ~/.config subdir if missing
DESTDIR="${HOME}/.config"
[[ -d ${DESTDIR} ]] || mkdir -p ${DESTDIR}

# Function to install packages, preferring Homebrew and falling back to APT if Homebrew isn't available
install_package() {
    command_name=$1
    package_name=${2:-$1}

    which $command_name &> /dev/null || {
        if which brew &> /dev/null; then
            brew install $package_name
        elif which apt &> /dev/null; then
            sudo apt install -y $package_name
        else
            echo "No suitable package manager found for installing $package_name"
        fi
    }
}
# Package installation commands
install_package aws-vault
install_package direnv
install_package fd fd fd-find
install_package fzf
install_package lazygit
install_package lsd
install_package op 1password-cli
install_package rg ripgrep
install_package starship

# Install mise, a polyglot tool version manager (https://mise.jdx.dev)
mise version &> /dev/null || curl https://mise.jdx.dev/install.sh | sh

# Install Krew plugin manager for kubectl (https://krew.sigs.k8s.io)
kubectl krew version &> /dev/null || (
  set -x; cd "$(mktemp -d)" &&
  OS="$(uname | tr '[:upper:]' '[:lower:]')" &&
  ARCH="$(uname -m | sed -e 's/x86_64/amd64/' -e 's/\(arm\)\(64\)\?.*/\1\2/' -e 's/aarch64$/arm64/')" &&
  KREW="krew-${OS}_${ARCH}" &&
  curl -fsSLO "https://github.com/kubernetes-sigs/krew/releases/latest/download/${KREW}.tar.gz" &&
  tar zxvf "${KREW}.tar.gz" &&
  ./"${KREW}" install krew
)

# Install LunarVim if missing
if [[ ! -e ${HOME}/.local/bin/lvim ]]; then
  LV_BRANCH='release-1.3/neovim-0.9'
  bash <(curl -s https://raw.githubusercontent.com/LunarVim/LunarVim/${LV_BRANCH}/utils/installer/install.sh)
fi

